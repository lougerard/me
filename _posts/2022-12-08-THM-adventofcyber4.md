---
title: Advent of Cyber 2022
author: CYB3RM3
name: CYB3RM3 | Advent of Cyber 2022
date: 2022-11-13 12:50:21 +0100
categories: [TryHackMe, AdventOfCyber]
tags: ["2022", AOC, Framework, Log Analysis, OSINT, Scanning, Brute-Forcing, Email Analysis, CyberChef, Smart Contracts, Pivoting, Hack a game, Memory Forensics, Packet Analysis, Web Application, Web, Malware, Forensics, Secure Coding, Sigma, Hardware Hacking, Hardware, Firmware, MQTT, Attack Surface Reduction, Defense in Depth]
---

Get started with Cyber Security in 24 Days - learn the basics by doing a new, beginner-friendly security challenge every day leading up to Christmas.

THM Room [https://tryhackme.com/room/adventofcyber4](https://tryhackme.com/room/adventofcyber4)


## TASK 1 : Introduction
### Read the above and check out the prizes! 
No Answer

## TASK 2 : Short Tutorial & Rules
### Practice connecting to our network! 
No Answer

## TASK 3 : Our Socials
###  Follow us on LinkedIn!
No Answer.

### Join our Discord and say hi!
No Answer.

### Follow us on Twitter!
No Answer.

### Check out the subreddit!
No Answer.

### Join us on Instagram!
No Answer.

### Follow us on Facebook!
No Answer.

### See what we do on Pinterest!
No Answer.

## TASK 4 : Subscribing, TryHackMe for Business & Christmas Swag!
### Read the above.
No Answer.

## TASK 5 : Nightmare Before Elfmas - The Story
### The Christmas story is used within some of the tasks, so make sure you read the above.
No Answer.

## TASK 6 : [Day 1] Frameworks Someone's coming to town!
### Who is the adversary that attacked Santa's network this year? 
This Task offer an series of 3 puzzles to solve to get the answer. 

![Puzzles](/images/thm/adventofcyber4/adventofcyber4_1.png)
_Puzzles_

Each puzzle refers to one cycle explained in the task. For those who are not familiar with the unified kill chain, here's a reminder of the cycles : 

![Cycle 1](/images/thm/adventofcyber4/adventofcyber4_2.png)
_Cycle 1_

So the puzzle is : 

![Puzzle 1](/images/thm/adventofcyber4/adventofcyber4_3.png)
_Puzzle 1_

![Puzzle 1](/images/thm/adventofcyber4/adventofcyber4_4.png)
_Puzzle 1_

For the cycle 2 :

![Cycle 2](/images/thm/adventofcyber4/adventofcyber4_5.png)
_Cycle 2_

![Puzzle 2](/images/thm/adventofcyber4/adventofcyber4_6.png)
_Puzzle 2_

And finally, cycle 3 :

![Cycle 3](/images/thm/adventofcyber4/adventofcyber4_7.png)
_Cycle 3_

![Puzzle 3](/images/thm/adventofcyber4/adventofcyber4_8.png)
_Puzzle 3_

Solving this last puzzle gives us the name of the adversary that attacked Santa's network this year !!

![Puzzle 3](/images/thm/adventofcyber4/adventofcyber4_9.png)
_Puzzle 3_

Answer : The Bandit Yeti

### What's the flag that they left behind?
Flag show in previous capture from above task.

Answer : THM{IT'S A Y3T1 CHR1$TMA$}

### Looking to learn more? Check out the rooms on Unified Kill Chain, Cyber Kill Chain, MITRE, or the whole Cyber Defence Frameworks module!
No Answer.

## TASK 7 : [Day 2] Log Analysis Santa's Naughty & Nice Log
### Ensure you are connected to the deployable machine in this task. 

No Answer.

### Use the ls command to list the files present in the current directory. How many log files are present?

```console
elfmcblue@day-2-log-analysis:~$ ls
SSHD.log  webserver.log
```
{: .nolineno }

Answer : 2

### Elf McSkidy managed to capture the logs generated by the web server. What is the name of this log file?
From above output.

Answer : webserver.log

### Begin investigating the log file from question #3 to answer the following questions.
Open the webserver.log with nano or vim to have an overview of the file content :

![webserver.log](/images/thm/adventofcyber4/adventofcyber4_10.png)
_webserver.log_

Answer : 1

### On what day was Santa's naughty and nice list stolen?

Using the grep command to search for our keyword :

![naughty-list](/images/thm/adventofcyber4/adventofcyber4_11.png)
_naughty-list_

The 18 of november 2022 was a friday !

Answer : Friday

### What is the IP address of the attacker?
From the previous search, we got the IP requesting the naughty list : 10.10.249.191

Answer : 10.10.249.191

### What is the name of the important list that the attacker stole from Santa?
We can search for all 'HTTP/1.1" 200' in our log file :

![santaslist.txt](/images/thm/adventofcyber4/adventofcyber4_12.png)
_santaslist.txt_

Answer : santaslist.txt

### Look through the log files for the flag. The format of the flag is: THM{}

Searching with grep in both logs. The webserver.log return no result but I found the flag in the SSHD.log :

![Flag](/images/thm/adventofcyber4/adventofcyber4_13.png)
_Flag_

Answer : THM{STOLENSANTASLIST}

### Interested in log analysis? We recommend the Windows Event Logs room or the Endpoint Security Monitoring Module.

No Answer.

## TASK 8 : [Day 3] OSINT Nothing escapes detective McRed
### What is the name of the Registrar for the domain santagift.shop? 

We can find the registrar of a domain with multiple tools as online DomainTools <https://whois.domaintools.com/> :

![DomainTools](/images/thm/adventofcyber4/adventofcyber4_14.png)
_DomainTools_

We can submit our domain name and after checking the "we are not a robot" box, we have the following result :

![Namecheap Inc](/images/thm/adventofcyber4/adventofcyber4_15.png)
_Namecheap Inc_

Answer : Namecheap Inc

### Find the website's source code (repository) on github.com and open the file containing sensitive credentials. Can you find the flag?

A quick googling search leads us to muhammadthm/SantaGiftShop repository and especially the config.php file : 

![SantaGiftShop](/images/thm/adventofcyber4/adventofcyber4_16.png)
_SantaGiftShop_

We can find the flag directly by inspecting the file :

![SantaGiftShop Github](/images/thm/adventofcyber4/adventofcyber4_17.png)
_SantaGiftShop Github_

Or by requesting the content of the file with some tools like curl with the raw url of our file :

```console
C:\Users\User>curl https://raw.githubusercontent.com/muhammadthm/SantaGiftShop/main/config.php
<?php
$FLAG = '{THM_OSINT_WORKS}';
/**
 * If you have arrived here, the flag value is {THM_OSINT_WORKS}
 *
 * The wp-config.php creation script uses this file during the installation.
 * You don't have to use the web site, you can copy this file to "wp-config.php"
 * and fill in the values.
 *
 * This file contains the following configurations:
 *
 * * Database settings
 * * Secret keys
 * * Database table prefix
 * * ABSPATH
 *
 *
 */

$ENV = "PROD"; //santagift.shop - Incase of QA, it will be qa.santagift.shop
[...]
```
{: .nolineno }

Answer : {THM_OSINT_WORKS}

### What is the name of the file containing passwords?
From our previous research : config.php

Answer : config.php

### What is the name of the QA server associated with the website?

We can pipe our curl command with the findstr (on windows) or grep (on linux) to find the keyword we are looking for :

```console
C:\Users\User>curl https://raw.githubusercontent.com/muhammadthm/SantaGiftShop/main/config.php | findstr "QA"
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  3512  100  3512    0     0  86088      0 --:--:-- --:--:-- --:--:-- 87800
$ENV = "PROD"; //santagift.shop - Incase of QA, it will be qa.santagift.shop
if($ENV = "QA"){...}
```
{: .nolineno }

Answer : qa.santagift.shop

### What is the DB_PASSWORD that is being reused between the QA and PROD environments?

In the same way, we can retreive the password :

```console
C:\Users\User>curl https://raw.githubusercontent.com/muhammadthm/SantaGiftShop/main/config.php | findstr "DB_PASS"
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  3512  100  3512    0     0  15495      0 --:--:-- --:--:-- --:--:-- 15608
define( 'DB_PASSWORD', 'S@nta2022' );
define( 'DB_PASSWORD', 'S@nta2022' );
```
{: .nolineno }

Answer : S@nta2022

### Check out this room if you'd like to learn more about Google Dorking!
No Answer.

## TASK 9 : [Day 4] Scanning Scanning through the snow
### What is the name of the HTTP server running on the remote host? 
We can have this information running scans like nmap or nikto : 

```console
root@ip-10-10-116-95:~# nikto -h 10.10.11.116
- Nikto v2.1.5
---------------------------------------------------------------------------
+ Target IP:          10.10.11.116
+ Target Hostname:    ip-10-10-11-116.eu-west-1.compute.internal
+ Target Port:        80
+ Start Time:         2022-12-09 07:04:56 (GMT0)
---------------------------------------------------------------------------
+ Server: Apache/2.4.29 (Ubuntu)
+ Server leaks inodes via ETags, header found with file /, fields: 0x2aa6 0x5eca7b0d75572 
+ The anti-clickjacking X-Frame-Options header is not present.
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Allowed HTTP Methods: OPTIONS, HEAD, GET, POST 
+ OSVDB-3233: /icons/README: Apache default file found.
+ 6544 items checked: 0 error(s) and 4 item(s) reported on remote host
+ End Time:           2022-12-09 07:05:09 (GMT0) (13 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested

root@ip-10-10-116-95:~# nmap -sC -vv 10.10.11.116

Starting Nmap 7.60 ( https://nmap.org ) at 2022-12-09 07:06 GMT
NSE: Loaded 118 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 2) scan.
Initiating NSE at 07:06
Completed NSE at 07:06, 0.00s elapsed
[...]
PORT    STATE SERVICE      REASON
22/tcp  open  ssh          syn-ack ttl 64
| ssh-hostkey: 
|   2048 0a:11:12:13:e3:f8:2b:ec:b8:84:82:72:9e:9e:09:9e (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDAvnAJeyJXRrG6K8AOsIr1v27FgR9HcTEjbQUUCDlds5+tKN0U3ySNdE2O7PaG87yvlidk1r6DAyBRJbTT4X6yhofatfJLNM9NeXOgLx0k5YZWO3OtA7eRsJAKpw2AecfANwjDO6XBoG8dV9jf3xtoHORdLA/cdyXQElpGbrhOWUxmMWfZS1efPZux4PApzubugku4lg3z13fc83jJo8w+Adi4tKwgtK4GysBwcSUB4/06dUVj2Ef4Yh2/1v2+oWhCBYMapoFGhsVVxgRRmnar/LmCifXIXC+lnXQQTlOfZ6q02g2/sNFO7ni9TkFM7c7ecjTC7xeycG05PDWOCxtp
|   256 56:b0:c2:d6:bd:3a:a7:25:d2:56:5a:78:09:86:8d:08 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCJ/AGZ/02ogCNws2ds1t7FlcKMhR5M0hcUxbaa2lBtFz3K9D1dsp1QlsyqLcXVIt+OKcp17y1NDFCIxyCfv9jY=
|   256 08:f6:15:ee:21:58:32:aa:d9:33:8c:cd:c8:99:c7:2b (EdDSA)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINe6oUarVynJ0ZuP34XzXOr2mxOine82dX2nlqfR6XNx
80/tcp  open  http         syn-ack ttl 64
| http-methods: 
|_  Supported Methods: OPTIONS HEAD GET POST
|_http-title: Apache2 Ubuntu Default Page: It works
139/tcp open  netbios-ssn  syn-ack ttl 64
445/tcp open  microsoft-ds syn-ack ttl 64
MAC Address: 02:BF:C1:54:88:FB (Unknown)

[...]
```
{: .nolineno }


Answer : Apache

### What is the name of the service running on port 22 on the QA server?

Running a nmap scan on port 22 :

```console
root@ip-10-10-116-95:~# nmap -p 22 -vv 10.10.11.116

Starting Nmap 7.60 ( https://nmap.org ) at 2022-12-09 07:05 GMT
Initiating ARP Ping Scan at 07:05
Scanning 10.10.11.116 [1 port]
Completed ARP Ping Scan at 07:05, 0.22s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 07:05
Completed Parallel DNS resolution of 1 host. at 07:05, 0.00s elapsed
Initiating SYN Stealth Scan at 07:05
Scanning ip-10-10-11-116.eu-west-1.compute.internal (10.10.11.116) [1 port]
Discovered open port 22/tcp on 10.10.11.116
Completed SYN Stealth Scan at 07:05, 0.22s elapsed (1 total ports)
Nmap scan report for ip-10-10-11-116.eu-west-1.compute.internal (10.10.11.116)
Host is up, received arp-response (0.00018s latency).
Scanned at 2022-12-09 07:05:38 GMT for 1s

PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack ttl 64
MAC Address: 02:BF:C1:54:88:FB (Unknown)

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 0.59 seconds
           Raw packets sent: 3 (116B) | Rcvd: 3 (116B)
```
{: .nolineno }

Answer : ssh

### What flag can you find after successfully accessing the Samba service?

We can list the smb shares with "smbclient" :

```console
root@ip-10-10-116-95:~# smbclient -L 10.10.11.116
WARNING: The "syslog" option is deprecated
Enter WORKGROUP\root's password: 

	Sharename       Type      Comment
	---------       ----      -------
	print$          Disk      Printer Drivers
	sambashare      Disk      Samba on Ubuntu
	admins          Disk      Samba on Ubuntu
	IPC$            IPC       IPC Service (ip-10-10-11-116 server (Samba, Ubuntu))
Reconnecting with SMB1 for workgroup listing.

	Server               Comment
	---------            -------

	Workgroup            Master
	---------            -------
	WORKGROUP            IP-10-10-11-116
```
{: .nolineno }

We assume we got previously a compromised username (ubuntu) and password (S@nta2022) so we can connect to the shares :

```console
root@ip-10-10-116-95:~# smbclient -U ubuntu //10.10.11.116/admins
WARNING: The "syslog" option is deprecated
Enter WORKGROUP\ubuntu's password: 
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Nov 10 05:44:30 2022
  ..                                  D        0  Wed Nov  9 17:43:21 2022
  flag.txt                            A       23  Wed Nov  9 17:55:58 2022
  userlist.txt                        A      111  Thu Nov 10 05:44:29 2022

		40581564 blocks of size 1024. 38229264 blocks available
smb: \> 
```
{: .nolineno }

We can now download the 2 files present on the admins share and retreive the flag :

```console


smb: \> get flag.txt 
getting file \flag.txt of size 23 as flag.txt (7.5 KiloBytes/sec) (average 7.5 KiloBytes/sec)
smb: \> get userlist.txt 
getting file \userlist.txt of size 111 as userlist.txt (54.2 KiloBytes/sec) (average 26.2 KiloBytes/sec)
smb: \> ^C
root@ip-10-10-116-95:~# cat flag.txt 
{THM_SANTA_SMB_SERVER}
```
{: .nolineno }

Answer : {THM_SANTA_SMB_SERVER}

### What is the password for the username santahr?

```console
root@ip-10-10-116-95:~# cat userlist.txt 
USERNAME	PASSWORD
santa		santa101
santahr		santa25
santaciso	santa30
santatech	santa200
santaaccounts	santa400
```
{: .nolineno }

Answer : santa25

### If you want to learn more scanning techniques, we have a module dedicated to Nmap!
No Answer.

## TASK 10 : [Day 5] Brute-Forcing He knows when you're awake 
### Use Hydra to find the VNC password of the target with IP address MACHINE_IP. What is the password? 
Hydra was crashing before returning the result, so i decide to use another tool with has an vnc-brute module : nmap.

```console
┌──(kali㉿kali)-[~]
└─$ nmap -Pn -p 5900 10.10.114.22 --script vnc-brute 
Starting Nmap 7.92 ( https://nmap.org ) at 2022-12-05 15:43 EST
Stats: 0:00:41 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 0.00% done
Stats: 0:00:42 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 0.00% done
Stats: 0:00:46 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 0.00% done
Stats: 0:00:48 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 0.00% done
Nmap scan report for 10.10.114.22
Host is up (0.033s latency).

PORT     STATE SERVICE
5900/tcp open  vnc
| vnc-brute: 
|   Accounts: 
|     1q2w3e4r - Valid credentials
|_  Statistics: Performed 951 guesses in 96 seconds, average tps: 9.8

Nmap done: 1 IP address (1 host up) scanned in 96.83 seconds
```
{: .nolineno }

Answer : 1q2w3e4r

### Using a VNC client on the AttackBox, connect to the target of IP address MACHINE_IP. What is the flag written on the target’s screen?

![Flag](/images/thm/adventofcyber4/adventofcyber4_18.png)
_Flag_

Answer : THM{I_SEE_YOUR_SCREEN}

### If you liked the topics presented in this task, check out these rooms next: Protocols and Servers 2, Hydra, Password Attacks, John the Ripper. 
No Answer.

## TASK 11 : [Day 6] Email Analysis It's beginning to look a lot like phishing 
### What is the email address of the sender? 

We can run the tool emlAnalyzer to get information about our eml file : 

```console
ubuntu@ip-10-10-203-126:~/Desktop$ emlAnalyzer -i Urgent\:.eml --header --html -u --text --extract-all
 ==============
 ||  Header  ||
 ==============
X-Pm-Content-Encryption.....end-to-end
X-Pm-Origin.................internal
Subject.....................Urgent: Blue section is down. Switch to the load share plan!
From........................Chief Elf <chief.elf@santaclaus.thm>
Date........................Tue, 6 Dec 2022 00:00:01 +0000
Mime-Version................1.0
Content-Type................multipart/mixed;boundary=---------------------03edd9c682a0c8f60d54b9e4bb86659f
To..........................elves.all@santaclaus.thm <elves.all@santaclaus.thm>
X-Attached..................Division_of_labour-Load_share_plan.doc
Message-Id..................<QW9DMjAyMl9FbWFpbF9BbmFseXNpcw==>
X-Pm-Spamscore..............3
Received....................from mail.santaclaus.thm by mail.santaclaus.thm; Tue, 6 Dec 2022 00:00:01 +0000
X-Original-To...............elves.all@santaclaus.thm
Return-Path.................<murphy.evident@bandityeti.thm>
Delivered-To................elves.all@santaclaus.thm

 =========================
 ||  URLs in HTML part  ||
 =========================
[+] No URLs found in the html

 =================
 ||  Plaintext  ||
 =================
[+] Email contains no plaintext

 ============
 ||  HTML  ||
 ============
<span>Dear Elves,</span><div><br></div><div><span>Due to technical problems in the blue section of our toy factory, we are having difficulties preparing some toys. </span></div><div><br></div><div><span>There
 are a few days left to Christmas, so we need to use time efficiently to
 prepare every wishlist we receive. Due to that, the blue section's 
workload is shared with the rest to avoid any toy production delay.</span></div><div><br></div><div><span>The detailed division of labour is included in the attached document.</span></div><div><br></div><div><span>Good luck to you all.</span></div><div><br></div><div><b><span>Chief Elf</span></b></div><div><br></div>

 =============================
 ||  Attachment Extracting  ||
 =============================
[+] Attachment [1] "Division_of_labour-Load_share_plan.doc" extracted to eml_attachments/Division_of_labour-Load_share_plan.doc
ubuntu@ip-10-10-203-126:~/Desktop$ 
```
{: .nolineno }

From this result we got the email from the sender.

Answer : chief.elf@santaclaus.thm

### What is the return address?

Answer : murphy.evident@bandityeti.thm

### On whose behalf was the email sent?

Answer : Chief Elf

### What is the X-spam score?

Answer : 3

### What is hidden in the value of the Message-ID field?

It's "QW9DMjAyMl9FbWFpbF9BbmFseXNpcw==", a base64 encoded message, while decoded : 

```console
ubuntu@ip-10-10-203-126:~/Desktop$ echo "QW9DMjAyMl9FbWFpbF9BbmFseXNpcw==" | base64 -d
AoC2022_Email_Analysis
```
{: .nolineno }

Answer : AoC2022_Email_Analysis

### Visit the email reputation check website provided in the task. What is the reputation result of the sender's email address?

Visiting emailrep.io :

![Emailrep](/images/thm/adventofcyber4/adventofcyber4_19.png)
_Emailrep_

![Emailrep](/images/thm/adventofcyber4/adventofcyber4_20.png)
_Emailrep_

Answer : RISKY

### Check the attachments. What is the filename of the attachment?

Answer : Division_of_labour-Load_share_plan.doc

### What is the hash value of the attachment?

```console
ubuntu@ip-10-10-203-126:~/Desktop$ sha256sum "eml_attachments/Division_of_labour-Load_share_plan.doc"
0827bb9a2e7c0628b82256759f0f888ca1abd6a2d903acdb8e44aca6a1a03467  eml_attachments/Division_of_labour-Load_share_plan.doc
```
{: .nolineno }

Answer : 0827bb9a2e7c0628b82256759f0f888ca1abd6a2d903acdb8e44aca6a1a03467

### Visit the Virus Total website and use the hash value to search. Navigate to the behaviour section. What is the second tactic marked in the Mitre ATT&CK section?

![VirusTotal](/images/thm/adventofcyber4/adventofcyber4_21.png)
_VirusTotal_

![Emailrep](/images/thm/adventofcyber4/adventofcyber4_22.png)
_VirusTotal_

Answer : Defense Evasion

### Visit the InQuest website and use the hash value to search. What is the subcategory of the file?

On [InQuest](https://labs.inquest.net/dfi/search/hash/sha256/0827bb9a2e7c0628b82256759f0f888ca1abd6a2d903acdb8e44aca6a1a03467##eyJyZXN1bHRzIjpbIn4iLCJmaXJzdFNlZW4iLDEsIiIsW11dfQ==), we can view the subcategory of our malicious file :

![InQuest](/images/thm/adventofcyber4/adventofcyber4_23.png)
_InQuest_

Answer : macro_hunter

### If you want to learn more about phishing and analysing emails, check out the Phishing module!

No Answer.

## TASK 12 : [Day 7] CyberChef Maldocs roasting on an open fire 
### What is the version of CyberChef found in the attached VM? 

![CyberChef](/images/thm/adventofcyber4/adventofcyber4_24.png)
_CyberChef_

Answer : 9.49.0

### How many recipes were used to extract URLs from the malicious doc?

10 :

- Extract Strings
- Remove Pattern
- Drop bytes
- Decode base64
- Decode UTF-16
- Find/replace common patterns
- Find/replace
- Extract URLs
- Split @
- Defang URL

Answer : 10

### We found a URL that was downloading a suspicious file; what is the name of that malware?

![Bandit Yeti URL](/images/thm/adventofcyber4/adventofcyber4_25.png)
_Bandit Yeti URL_

Answer : mysterygift.exe

### What is the last defanged URL of the bandityeti domain found in the last step?

Answer : hxxps[://]cdn[.]bandityeti[.]THM/files/index/

### What is the ticket found in one of the domains? (Format: Domain/<GOLDEN_FLAG>)

Answer : THM_MYSTERY_FLAG

### If you liked the investigation today, you might also enjoy the Security Information and Event Management module!

No Answer.

## TASK 13 : [Day 8] Smart Contracts Last Christmas I gave you my ETH 

### If not already completed, download the zip folder attached to this task, and open Remix in your preferred browser.

No Answer.

### What flag is found after attacking the provided EtherStore Contract?

We must first set up the environment [Remix IDE](https://remix.ethereum.org/). You can do as below :

1. Import the .sol files :

	![Remix IDE](/images/thm/adventofcyber4/adventofcyber4_26.png)
	_Remix IDE_

2. Compiling the files :

	To compile  the files, you have to select one of them, them move to the menu solidity compiler and press the compile button if it's not in auto-compile mode :

	![Remix IDE Compile](/images/thm/adventofcyber4/adventofcyber4_27.png)
	_Remix IDE Compile_

3. Deploy the EtherSotre instance :

	![Remix IDE Deploy](/images/thm/adventofcyber4/adventofcyber4_28.png)
	_Remix IDE Deploy_

	Once done, you should have a success message in the console :

	![Remix IDE success message](/images/thm/adventofcyber4/adventofcyber4_29.png)
	_Remix IDE success message_

4. Test the instance :

	We can try a deposit of a certain amount of Ether on the instance :

	![Remix IDE Deposit](/images/thm/adventofcyber4/adventofcyber4_30.png)
	_Remix IDE Deposit_

	This also result with a success message for the deposit() function :

	![Remix IDE Deposit Success](/images/thm/adventofcyber4/adventofcyber4_31.png)
	_Remix IDE Deposit Success_

5. Setting up the exploit instance :

	To do this, we have to change our account then copy the address from our EtherStore instance and click the "At Address" button. The newly created instance appears in the deployed contracts.

	![Remix IDE Attack Preparation](/images/thm/adventofcyber4/adventofcyber4_32.png)
	_Remix IDE Attack Preparation_

6. Launch the exploit :

	As per explanation, to exploit this Smart Contract, we have to deposit Ether again and withdraw it immediately after for example. Let's try that :

	![Remix IDE Attack](/images/thm/adventofcyber4/adventofcyber4_33.png)
	_Remix IDE Attack_

	The flag appears the console.

	Answer : flag{411_ur_37h_15_m1n3}

### Are you up for a little challenge to celebrate Day 8? Try your hand at these easy challenge rooms: Quotient and Agent T!

No Answer.

## TASK 14 : [Day 9] Pivoting Dock the halls 
### Deploy the attached VM, and wait a few minutes. What ports are open?

We can start with a nmap scan to discover open ports :

```console
root@ip-10-10-84-19:~# nmap -sC -vv 10.10.228.238

Starting Nmap 7.60 ( https://nmap.org ) at 2022-12-15 09:19 GMT
NSE: Loaded 118 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 2) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 0.00s elapsed
NSE: Starting runlevel 2 (of 2) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 0.00s elapsed
Initiating ARP Ping Scan at 09:19
Scanning 10.10.228.238 [1 port]
Completed ARP Ping Scan at 09:19, 0.22s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 09:19
Completed Parallel DNS resolution of 1 host. at 09:19, 0.00s elapsed
Initiating SYN Stealth Scan at 09:19
Scanning ip-10-10-228-238.eu-west-1.compute.internal (10.10.228.238) [1000 ports]
Discovered open port 80/tcp on 10.10.228.238
Completed SYN Stealth Scan at 09:19, 1.25s elapsed (1000 total ports)
NSE: Script scanning 10.10.228.238.
NSE: Starting runlevel 1 (of 2) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 4.10s elapsed
NSE: Starting runlevel 2 (of 2) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 0.00s elapsed
Nmap scan report for ip-10-10-228-238.eu-west-1.compute.internal (10.10.228.238)
Host is up, received arp-response (0.0013s latency).
Scanned at 2022-12-15 09:19:01 GMT for 6s
Not shown: 999 closed ports
Reason: 999 resets
PORT   STATE SERVICE REASON
80/tcp open  http    syn-ack ttl 63
|_http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E
| http-methods: 
|_  Supported Methods: GET HEAD OPTIONS
|_http-title: Curabitur aliquet, libero id suscipit semper
MAC Address: 02:C7:69:A1:D8:63 (Unknown)

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 2) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 0.00s elapsed
NSE: Starting runlevel 2 (of 2) scan.
Initiating NSE at 09:19
Completed NSE at 09:19, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 6.45 seconds
           Raw packets sent: 1002 (44.072KB) | Rcvd: 1002 (40.072KB)
```
{: .nolineno }

Answer : 80

### What framework is the web application developed with?

When opening the website we arrives on this page :

![Laravel Website](/images/thm/adventofcyber4/adventofcyber4_34.png)
_Laravel Website_

Answer : Laravel

### What CVE is the application vulnerable to?

A quick google search give us a first possible CVE : 

![Laravel Vulnerability](/images/thm/adventofcyber4/adventofcyber4_35.png)
_Laravel Vulnerability_

Then verifying this [CVE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-3129) :

![CVE-2021-3129](/images/thm/adventofcyber4/adventofcyber4_36.png)
_CVE-2021-3129_

Our version of Laravel is vulnerable to this vulnerability.

Answer : CVE-2021-3129 

### What command can be used to upgrade the last opened session to a Meterpreter session?

For those who didn't konw the command, it was explained in the task :

![sessions](/images/thm/adventofcyber4/adventofcyber4_37.png)
_sessions_

Answer : sessions -u -1

### What file indicates a session has been opened within a Docker container?

We know we are in a dacker if the file /.dockerenv exist :

![dockerenv](/images/thm/adventofcyber4/adventofcyber4_38.png)
_dockerenv_

Answer : /.dockerenv

### What file often contains useful credentials for web applications?

Answer : .env

### What database table contains useful credentials?

Answer : users

### What is Santa's password?

Answer : p4$$w0rd

### What ports are open on the host machine?

Answer : 22,80

### What is the root flag?

Answer : THM{47C61A0FA8738BA77308A8A600F88E4B}

### Day 9 is done! You might want to take a well-deserved rest now. If this challenge was right up your alley, though, we think you might enjoy the Compromising Active Directory module! 

No Answer.

## TASK 15 : [Day 10] Hack a game You're a mean one, Mr. Yeti 

### What is the Guard's flag?

This task is a game break challenge with all needed materials in the provided machine to deploy.

When we run the "save Mc Skiddy" shorcut on the Desktop, it launch a web-browser game. We can open the Cetus addin from the developper tools :

![developper tools](/images/thm/adventofcyber4/adventofcyber4_39.png)
_developper tools_

Then let's take a look at the game :

![Game](/images/thm/adventofcyber4/adventofcyber4_40.png)
_Game_

We can speak to a guard at the right of the screen. After some dialogues, he will makes us a deal to escape the prison :

![Guard](/images/thm/adventofcyber4/adventofcyber4_41.png)
_Guard_

As we don't now the answer, let's try something random :

![Guard Challenge Random](/images/thm/adventofcyber4/adventofcyber4_42.png)
_Guard Challenge Random_

And it's oviously not the correct answer :

![Guard Challenge Answer](/images/thm/adventofcyber4/adventofcyber4_43.png)
_Guard Challenge Answer_

But now we have the exact value of the number, we can use CETUS to determine the memory address of the stored "needed number" :

![Guard Challenge address](/images/thm/adventofcyber4/adventofcyber4_44.png)
_Guard Challenge address_

If we convert this hex value to decimal, it is our requested number : 

![Guard Challenge address translated](/images/thm/adventofcyber4/adventofcyber4_45.png)
_Guard Challenge address translated_

Now we control the memory address with the answer, we can play again the problem asked by the guard and just read the requested number before answering the guard. For this, let's save as bookmark the memory address and switch to bookmarks tab :

![Bookmarks](/images/thm/adventofcyber4/adventofcyber4_46.png)
_Bookmarks_

Now let's ask the guard again for the number :

![Guard Challenge](/images/thm/adventofcyber4/adventofcyber4_47.png)
_Guard Challenge_

Before answering, we can convert the new value stored at the memory address saved :

![Guard Challenge Correct Answer](/images/thm/adventofcyber4/adventofcyber4_48.png)
_Guard Challenge Correct Answer_

We can enter this value and hit "enter" :

![Guard Challenge solved](/images/thm/adventofcyber4/adventofcyber4_49.png)
_Guard Challenge solved_

![Guard Challenge solved 2](/images/thm/adventofcyber4/adventofcyber4_50.png)
_Guard Challenge solved 2_

When the dialogue end, we can speak to the guard again to have his flag :

![Guard Challenge Flag](/images/thm/adventofcyber4/adventofcyber4_51.png)
_Guard Challenge Flag_

Answer : THM{5_star_Fl4gzzz}

### What is the Yeti's flag?

Let's move on the bridge, now that the door is open :

![Cannon Challenge](/images/thm/adventofcyber4/adventofcyber4_52.png)
_Cannon Challenge_

We can try to pass the cannon snowball (1) but it seems to affect our health point (2) :

![Cannon Challenge try](/images/thm/adventofcyber4/adventofcyber4_53.png)
_Cannon Challenge try_

So we need to find a way to get around this part. Passing through all canon snowballs his next to impossible !

Let's try to determine the health point memory address. Honnestly, i get it first try, but you may required some reflection to get this one. I started with the idea that health point may be something like 100 (for 100% or traditionaly 100 HP). So what does CETUS gives us for 100 :

![Cannon Challenge HP](/images/thm/adventofcyber4/adventofcyber4_54.png)
_Cannon Challenge HP_

We get 31 different results. We can try to loose some hp an see which result has changed with a value "LT" (less then) 100 :

![Cannon Challenge HP Value](/images/thm/adventofcyber4/adventofcyber4_55.png)
_Cannon Challenge HP Value_

It seems we found the right memory address linked to our health point. We can bookmarked this memory address and freeze its value :

![Cannon Challenge HP Freeze](/images/thm/adventofcyber4/adventofcyber4_56.png)
_Cannon Challenge HP Freeze_

Now that we will not loose any HP, we can safely pass through all canons snowballs !

![Cannon Challenge success](/images/thm/adventofcyber4/adventofcyber4_57.png)
_Cannon Challenge success_

When we passed the bridge, we find the Bandit Yeti avatar :

![Bandit Yeti](/images/thm/adventofcyber4/adventofcyber4_58.png)
_Bandit Yeti_

The Yeti will face us with a last test but with our HP frozen it will go easily :

![Bandit Yeti Challenge](/images/thm/adventofcyber4/adventofcyber4_59.png)
_Bandit Yeti Challenge_

Reading all dialogues and you will get the bandit yeti's flag :

![Bandit Yeti Flag](/images/thm/adventofcyber4/adventofcyber4_60.png)
_Bandit Yeti Flag_

This is the end of this game break challenge !

Answer : THM{yetiyetiyetiflagflagflag}

### If you liked today's challenge, the [Walking an Application](https://tryhackme.com/room/walkinganapplication) room is an excellent follow-up!

No Answer.

## TASK 16 : [Day 11] Memory Forensics Not all gifts are nice 
### What is the Windows version number that the memory image captured?
First we need to check informations about the memory file :

![Memory file](/images/thm/adventofcyber4/adventofcyber4_61.png)
_Memory file_

It's a Windows memory file ! In this capture, we can also view the version number of Windows : "NtMajorVersion".

Answer : 10

### What is the name of the binary/gift that secret Santa left?
We can view the process list by running the command :

```console
python3 vol.py -f workstation.vmem windows.pslist
```
{: .nolineno }

![Memory pslist](/images/thm/adventofcyber4/adventofcyber4_62.png)
_Memory pslist_

[...]

![Memory pslist end](/images/thm/adventofcyber4/adventofcyber4_63.png)
_Memory pslist end_

Answer : mysterygift.exe

### What is the Process ID (PID) of this binary?

From the process list above.

Answer : 2040

### Dump the contents of this binary. How many files are dumped?

We can dump the content of the binary with the following command :

```console
python3 vol.py -f workstation.vmem windows.dumpfiles --pid 2040
```
{: .nolineno }

![Memory dumpfiles](/images/thm/adventofcyber4/adventofcyber4_64.png)
_Memory dumpfiles_

We get 16 object extract from this binary !

Answer : 16

### If you want to learn more about Volatility, please check out a dedicated room [here](https://tryhackme.com/room/volatility). For more content on forensics, we have a full [Digital Forensics and Incident Response](https://tryhackme.com/module/digital-forensics-and-incident-response) module for you!

No Answer.

## TASK 17 : [Day 12] Malware Analysis Forensic McBlue to the REVscue! 
### What is the architecture of the malware sample? (32-bit/64-bit)
Running "Detect it easy" on our malicious file :

![Detect it easy](/images/thm/adventofcyber4/adventofcyber4_65.png)
_Detect it easy_

We got the following results, including the architecture and the packer :

![architecture](/images/thm/adventofcyber4/adventofcyber4_66.png)
_architecture_

Answer : 64-bit

### What is the packer used in the malware sample? (format: lowercase)

Answer : UPX

### What is the compiler used to build the malware sample? (format: lowercase)

To have more information about the file, we can run the CAPA tool on our file :

![CAPA](/images/thm/adventofcyber4/adventofcyber4_67.png)
_CAPA_

But since our mysterygift file is packed, we need to unpack it for better analysis :

![mysterygift](/images/thm/adventofcyber4/adventofcyber4_68.png)
_mysterygift_

We can now run capa again on the file :

![capa mysterygift](/images/thm/adventofcyber4/adventofcyber4_69.png)
_capa mysterygift_

![capa mysterygift](/images/thm/adventofcyber4/adventofcyber4_70.png)
_capa mysterygift_

Answer : Nim

### How many MITRE ATT&CK techniques have been discovered attributed to the DISCOVERY tactic?

From previous captures :

![DISCOVERY mysterygift](/images/thm/adventofcyber4/adventofcyber4_71.png)
_DISCOVERY mysterygift_

Answer : 2

### What is the registry key abused by the malware?

If we filter by registry event and keeping only "RegCreateKey" events, we can see one special "CreateKey" value :

![CreateKey](/images/thm/adventofcyber4/adventofcyber4_72.png)
_CreateKey_

Answer : HKCU\Software\Microsoft\Windows\CurrentVersion\Run

### What is the value written on the registry key based on the previous question?

We can open the registry to view the value that was set :

![registry](/images/thm/adventofcyber4/adventofcyber4_73.png)
_registry_

![registry](/images/thm/adventofcyber4/adventofcyber4_74.png)
_registry_

Answer : C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\wishes.bat

### What are the names of two files created by the malware under the C:\Users\Administrator\ directory? (format: file1,file2 in alphabetical order)

We can filter by filesystem modification and keep "WriteFile" events :

![WriteFile](/images/thm/adventofcyber4/adventofcyber4_75.png)
_WriteFile_

Answer : test.jpg,wishes.bat

### What are the two domains wherein malware has initiated a network connection? (format: domain1,domain2 in alphabetical order)

To view contacted domain, we can use the filter "network" and check for TCP connection :

![network](/images/thm/adventofcyber4/adventofcyber4_76.png)
_network_

Answer : bestfestivalcompany.thm,virustotal.com

### Going back to strings inside the malware sample, what is the complete URL used to download the file hosted in the first domain accessed by the malware?

We can use the "strings" command on the file and search for "http://"  :

![strings](/images/thm/adventofcyber4/adventofcyber4_77.png)
_strings_

Answer : http://bestfestivalcompany.thm/favicon.ico

### If you enjoyed malware analysis, try the Intro to Malware Analysis or Dissecting PE Headers rooms next!

No Answer.

## TASK 18 : [Day 13] Packet Analysis Simply having a wonderful pcap time 
### View the "Protocol Hierarchy" menu. What is the "Percent Packets" value of the "Hypertext Transfer Protocol"?
The "protocol Hierarchy" menu is in the "statistics" menu :

![statistics](/images/thm/adventofcyber4/adventofcyber4_78.png)
_statistics_

We can search for HTTP statistics :

![HTTP](/images/thm/adventofcyber4/adventofcyber4_79.png)
_HTTP_

Answer : 0.3

### View the "Conversations". Navigate to the TCP section. Which port number has received more than 1000 packets?
In the "statistics" menu :

![Conversations](/images/thm/adventofcyber4/adventofcyber4_80.png)
_Conversations_

Then in theTCP sub-menu :

![RDP](/images/thm/adventofcyber4/adventofcyber4_81.png)
_RDP_

Answer : 3389

### What is the service name of the used protocol that received more than 1000 packets?

Quick googling on port 3389 for those who don't now this service : Remote Desktop Protocol (RDP)

Answer : RDP

### Filter the DNS packets. What are the domain names? Enter the domains in alphabetical order and defanged format. (format: domain[.]zzz,domain[.]zzz)
Filtering by DNS protocol in the pcap file (open with Wireshark) :

![DNS](/images/thm/adventofcyber4/adventofcyber4_82.png)
_DNS_


Answer : bestfestivalcompany[.]thm,cdn[.]bandityeti[.]thm

### Filter the HTTP packets. What are the names of the requested files? Enter the names in alphabetical order and in defanged format. (format: file[.]xyz,file[.]xyz)
Filtering on HTTP protocol :

![http filter](/images/thm/adventofcyber4/adventofcyber4_83.png)
_http filter_

Answer : favicon[.]ico,mysterygift[.]exe

### Which IP address downloaded the executable file? Enter your answer in defanged format.
We can view the IP address from the HTTP GET request for "mysterygift.exe" :

![http source](/images/thm/adventofcyber4/adventofcyber4_84.png)
_http source_

Answer : 10[.]10[.]29[.]186

### Which domain address hosts the malicious file? Enter your answer in defanged format.
We can see this information in HTTP section :

![http host](/images/thm/adventofcyber4/adventofcyber4_85.png)
_http host_

Answer : cdn[.]bandityeti[.]thm

### What is the "user-agent" value used to download the non-executable file?

This can be found in the same HTTP section but for the other GET request :

![user-agent](/images/thm/adventofcyber4/adventofcyber4_86.png)
_user-agent_

Answer : Nim httpclient/1.6.8

### Export objects from the PCAP file. Calculate the file hashes. What is the sha256 hash value of the executable file?
We can export the exe file we captured in the HTTP request via the menu "File" :

![user-agent](/images/thm/adventofcyber4/adventofcyber4_87.png)
_user-agent_

![user-agent](/images/thm/adventofcyber4/adventofcyber4_88.png)
_user-agent_

Then we can calculate the SHA256 from terminal :

![SHA256](/images/thm/adventofcyber4/adventofcyber4_89.png)
_SHA256_

Answer : 0ce160a54d10f8e81448d0360af5c2948ff6a4dbb493fe4be756fc3e2c3f900f

### Search the hash value of the executable file on VirusTotal. Navigate to the "Behaviour" section. There are multiple IP addresses associated with this file.  What are the connected IP addresses? Enter the IP addressed defanged and in numerical order. (format: IPADDR,IPADDR)

![VirusTotal](/images/thm/adventofcyber4/adventofcyber4_90.png)
_VirusTotal_

Then we go to the relation tab : 

![VirusTotal relation](/images/thm/adventofcyber4/adventofcyber4_91.png)
_VirusTotal relation_

From those IP addresses, we need to exclude google one (8.8.8.8) and the private IP address (192.168.0.18).

Answer : 20[.]99[.]133[.]109,20[.]99[.]184[.]37,23[.]216[.]147[.]64,23[.]216[.]147[.]76

### If you liked working with Wireshark, we have a comprehensive module on this helpful tool here. If you want to dive deeper, the Network Security and Traffic Analysis module is waiting for you!

No Answer.

## TASK 19 : [Day 14] Web Applications I'm dreaming of secure web apps
## TASK 20 : [Day 15] Secure Coding Santa is looking for a Sidekick 
## TASK 21 : [Day 16] Secure Coding SQLi’s the king, the carolers sing
## TASK 22: [Day 17] Secure Coding Filtering for Order Amidst Chaos 
## TASK 23: [Day 18] Sigma Lumberjack Lenny Learns New Rules 
## TASK 24: [Day 19] Hardware Hacking Wiggles go brrr 
## TASK 25: [Day 20] Firmware Binwalkin’ around the Christmas tree 
## TASK 26: [Day 21] MQTT Have yourself a merry little webcam 
## TASK 27 : [Day 22] Attack Surface Reduction Threats are failing all around me 
## TASK 28 : [Day 23] Defence in Depth Mission ELFPossible: Abominable for a Day 

```console

```
{: .nolineno }